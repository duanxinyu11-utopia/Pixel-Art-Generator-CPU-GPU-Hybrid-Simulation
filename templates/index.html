<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤å¤åƒç´ ç”»ç”Ÿæˆå™¨</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f0f0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .controls { margin: 20px 0; padding: 15px; background: #eee; border-radius: 8px; }
        select, button, input { padding: 10px; font-size: 16px; margin: 5px; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px;}
        button:hover { background-color: #0056b3; }
        .images { display: flex; justify-content: space-around; flex-wrap: wrap; margin-top: 20px; }
        .image-box { flex: 1; min-width: 300px; margin: 10px; }
        img { max-width: 100%; border: 2px solid #333; }
        #loading { display: none; color: #666; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¨ Pixel Art Generator</h1>

    <div class="controls">
        <input type="file" id="uploadInput" accept="image/*">

        <select id="modeSelect">
            <option value="cpu">CPU æ¨¡å¼ (æ…¢ - ä¸²è¡Œ)</option>
            <option value="gpu">GPU æ¨¡æ‹Ÿæ¨¡å¼ (å¿« - å¹¶è¡Œ)</option>
        </select>

        <select id="sizeSelect">
            <option value="8">ç²¾ç»† (8px)</option>
            <option value="16" selected>æ ‡å‡† (16px)</option>
            <option value="32">ç²—ç³™ (32px)</option>
        </select>

        <button onclick="generatePixelArt()">âœ¨ ç”Ÿæˆåƒç´ ç”»</button>
    </div>

    <p id="status">å‡†å¤‡å°±ç»ª</p>

    <div class="images">
        <div class="image-box">
            <h3>åŸå›¾</h3>
            <img id="originalImg" src="" alt="è¯·ä¸Šä¼ å›¾ç‰‡" style="display:none;">
        </div>
        <div class="image-box">
            <h3>ç»“æœ</h3>
            <img id="resultImg" src="" alt="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ" style="display:none;">
        </div>
    </div>
</div>

<script>
    // è¿™æ˜¯å‰ç«¯é€»è¾‘ï¼šè´Ÿè´£æŠŠå›¾ç‰‡ä¼ ç»™ Pythonï¼Œå¹¶æŠŠç»“æœæ˜¾ç¤ºå‡ºæ¥
    async function generatePixelArt() {
        const fileInput = document.getElementById('uploadInput');
        const mode = document.getElementById('modeSelect').value;
        const pixelSize = document.getElementById('sizeSelect').value;
        const status = document.getElementById('status');

        if (fileInput.files.length === 0) {
            alert("è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼");
            return;
        }

        const file = fileInput.files[0];

        // 1. æ˜¾ç¤ºåŸå›¾
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('originalImg').src = e.target.result;
            document.getElementById('originalImg').style.display = 'block';

            // 2. å‘é€è¯·æ±‚ç»™åç«¯
            sendToBackend(e.target.result, mode, pixelSize);
        }
        reader.readAsDataURL(file);
    }

    async function sendToBackend(base64Image, mode, pixelSize) {
        const status = document.getElementById('status');
        status.innerText = "â³ æ­£åœ¨è®¡ç®—ä¸­...";

        try {
            const response = await fetch('/api/pixelate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    image: base64Image,
                    mode: mode,
                    pixelSize: pixelSize
                })
            });

            const data = await response.json();

            if (response.ok) {
                // 3. æ˜¾ç¤ºç»“æœ
                document.getElementById('resultImg').src = "data:image/png;base64," + data.pixelArtImage;
                document.getElementById('resultImg').style.display = 'block';
                status.innerText = `âœ… å®Œæˆ! è€—æ—¶: ${data.processTime}`;
            } else {
                status.innerText = "âŒ é”™è¯¯: " + data.error;
            }
        } catch (error) {
            console.error(error);
            status.innerText = "âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åå°æ˜¯å¦è¿è¡Œ";
        }
    }
</script>

</body>
</html>